%%% @author Tony Rogvall <tony@rogvall.se>
%%% @copyright (C) 2017, Tony Rogvall
%%% @doc
%%%    Generate various gear icons
%%%    WARNING no animation image is written to eprom!!!
%%% @end
%%% Created :  6 Dec 2017 by Tony Rogvall <tony@rogvall.se>

-module(egear_icon).

-export([green/0, blue/0, red/0, erlang/0, xpm/2]).
-export([plain/3]).

%% construct an image of red pixels
red() ->
    plain({255,0,0},128,128).

green() ->
    plain({0,255,0},128,128).

blue() ->
    plain({0,0,255},128,128).

%% construct an imag with ONE palette entry
plain({R,G,B},W,H) ->
    %% 48 byte palette in BGR format
    Palette = palette([{R,G,B}]),
    Size = W*H*4,
    <<Palette/binary, 0:Size>>.

%% input a list of RGB tripple and output a palette of 48 bytes
%% padded with 0 entries if needed
palette(RGBs) ->
    RGBs1 = lists:sublist(RGBs, 16),  %% make sure max 16 entries,
    N = length(RGBs1),
    ZEntries = << <<0,0,0>> || _ <- lists:seq(1,16-N) >>,
    << << <<B,G,R>> || {R,G,B} <- RGBs1>>/binary, ZEntries/binary>>.

erlang() ->
    xpm([{$\s,0,{255,255,255}},
	 {$.,1,{16#8c,16#00,16#2f}},
	 {$+,2,{16#00,16#00,16#00}}],
[
 "                                                                                                                                ",
 " .................                                                                                             ................ ",
 " ................                                                                                               ............... ",
 " ...............                                           ...........                                           .............. ",
 " ..............                                          ................                                        .............. ",
 " ..............                                        ....................                                       ............. ",
 " .............                                        ......................                                      ............. ",
 " ............                                        ........................                                      ............ ",
 " ............                                       ..........................                                     ............ ",
 " ...........                                       ...........................                                      ........... ",
 " ...........                                      .............................                                     ........... ",
 " ..........                                       ..............................                                     .......... ",
 " ..........                                      ...............................                                     .......... ",
 " .........                                       ...............................                                     .......... ",
 " .........                                      ................................                                      ......... ",
 " .........                                      .................................                                     ......... ",
 " ........                                       .................................                                     ......... ",
 " ........                                      ..................................                                     ......... ",
 " .......                                       ..................................                                      ........ ",
 " .......                                                                                                               ........ ",
 " .......                                                                                                               ........ ",
 " ......                                                                                                                ........ ",
 " ......                                                                                                                ........ ",
 " ......                                                                                                                 ....... ",
 " ......                                                                                                                 ....... ",
 " ......                                                                                                                 ....... ",
 " .....                                                                                                                  ....... ",
 " .....                                                                                                                  ....... ",
 " .....                                                                                                                  ....... ",
 " .....                                                                                                                  ....... ",
 " .....                                                                                                                  ....... ",
 " ....                                                                                                                   ....... ",
 " ....                                                                                                                   ....... ",
 " ....                                                                                                                   ....... ",
 " ....                                                                                                                   ....... ",
 " ....                                                                                                                   ....... ",
 " ....                                                                                                                   ....... ",
 " ....                                                                                                                   ....... ",
 " ....                                         ................................................................................. ",
 " ....                                         ................................................................................. ",
 " ....                                         ................................................................................. ",
 " ....                                         ................................................................................. ",
 " ....                                         ................................................................................. ",
 " ....                                         ................................................................................. ",
 " ....                                          ................................................................................ ",
 " ....                                          ................................................................................ ",
 " ....                                          ................................................................................ ",
 " .....                                         ................................................................................ ",
 " .....                                         ................................................................................ ",
 " .....                                         ................................................................................ ",
 " .....                                         ................................................................................ ",
 " .....                                         ................................................................................ ",
 " .....                                          ............................................................................... ",
 " ......                                         ............................................................................... ",
 " ......                                         ............................................................................... ",
 " ......                                         ............................................................................... ",
 " ......                                          ......................................................  ...................... ",
 " .......                                         ......................................................    .................... ",
 " .......                                         .....................................................       .................. ",
 " .......                                          ....................................................         ................ ",
 " .......                                          ...................................................            .............. ",
 " ........                                         ..................................................               ............ ",
 " ........                                          ................................................                  .......... ",
 " .........                                         ...............................................                     ........ ",
 " .........                                          ..............................................                       ...... ",
 " .........                                           ............................................                          .... ",
 " ..........                                          ...........................................                          ..... ",
 " ..........                                           .........................................                           ..... ",
 " ...........                                           .......................................                           ...... ",
 " ...........                                            .....................................                           ....... ",
 " ............                                            ..................................                             ....... ",
 " ............                                             ................................                             ........ ",
 " .............                                             .............................                              ......... ",
 " ..............                                              ..........................                               ......... ",
 " ..............                                               .......................                                .......... ",
 " ...............                                                 .................                                  ........... ",
 " ................                                                    .........                                     ............ ",
 " ................                                                                                                  ............ ",
 " .................                                                                                                ............. ",
 " ..................                                                                                              .............. ",
 " ...................                                                                                            ............... ",
 "                                                                                                                                ",
 "                                                                                                                                ",
 "                                                                                                                                ",
 "                                                                                                                                ",
 "                                                                                                                                ",
 "                                                                                                                                ",
 "                                                                                                                   +++++        ",
 " ++++++++++          +++++++++            ++++                    ++++              ++++         +++++           ++++++++++     ",
 " ++++++++++          ++++++++++           ++++                   +++++              ++++         +++++          ++++++++++++    ",
 " ++++++++++          +++++++++++          ++++                   ++++++             +++++        +++++         ++++++++++++++   ",
 " ++++                ++++   ++++          ++++                   ++++++             ++++++       +++++        +++++      +++++  ",
 " ++++                ++++   +++++         ++++                  +++++++             +++++++      +++++       +++++        +++   ",
 " ++++                ++++    ++++         ++++                  ++++++++            ++++++++     +++++       ++++         +     ",
 " ++++                ++++    ++++         ++++                 ++++ ++++            ++++++++     +++++      +++++               ",
 " ++++                ++++   ++++          ++++                 ++++ ++++            ++++ ++++    +++++      ++++                ",
 " ++++++++++          ++++  +++++          ++++                 +++   ++++           ++++  ++++   +++++      ++++                ",
 " ++++++++++          ++++++++++           ++++                ++++   ++++           ++++   ++++  +++++      ++++      +++++++++ ",
 " ++++++++++          ++++++++++           ++++                ++++   +++++          ++++   ++++  +++++      ++++      +++++++++ ",
 " ++++                ++++++++             ++++                ++++    ++++          ++++    ++++ +++++      ++++      +++++++++ ",
 " ++++                +++++++++            ++++               +++++++++++++          ++++     +++++++++      +++++         ++++  ",
 " ++++                ++++ ++++            ++++               ++++++++++++++         ++++      ++++++++       ++++         ++++  ",
 " ++++                ++++ +++++           ++++              +++++++++++++++         ++++       +++++++       +++++        ++++  ",
 " ++++                ++++  +++++          ++++              +++++      ++++         ++++       +++++++        +++++      +++++  ",
 " ++++++++++          ++++  +++++          ++++++++++        ++++        ++++        ++++        ++++++        ++++++   ++++++   ",
 " ++++++++++          ++++   +++++         ++++++++++       ++++         ++++        ++++         +++++         +++++++++++++    ",
 " ++++++++++          ++++    +++++        ++++++++++       ++++         +++++       ++++          ++++          +++++++++++     ",
 " ++++++++++          ++++    +++++        +++++++++        +++           ++++        +++           ++             ++++++++      ",
 "                                                                                                                                "	
 ]).

xpm(XPMPalette,XPM) ->
    Palette = palette([Color||{_Char,_Index,Color} <- XPMPalette]),
    Data = xpm_rows(XPMPalette,XPM,128,[]),
    Pixmap = << <<I:4>> || I <- Data>>,
    <<Palette/binary, Pixmap/binary>>.

xpm_rows(_Palette, _, 0, Data) -> 
    lists:append(Data);
xpm_rows(Palette, [R|Rs], I, Data) ->
    D = xpm_row(Palette, R, 128, []),
    xpm_rows(Palette, Rs, I-1, [D|Data]);
xpm_rows(Palette, [], I, Data) ->
    xpm_rows(Palette, [], I-1, [lists:duplicate(128,0)|Data]).

xpm_row(_Palette,_Cs,0,Data) ->
    lists:reverse(Data);
xpm_row(Palette,[C|Cs],J,Data) ->
    {_,I,_Color} = lists:keyfind(C,1,Palette),
    xpm_row(Palette,Cs,J-1,[I|Data]);
xpm_row(Palette,[],J,Data) ->
    xpm_row(Palette,[],J-1,[0|Data]).
